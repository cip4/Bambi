<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:cip4="http://www.cip4.org/tags">

<ui:composition>
	<style>
	<!--
		.rich-stglpanel-header {
			text-align: left;
			font-size: 15px;
		}
		
		.rich-stglpanel-body {
			padding: 0px;
		}
		
		.device-table {
			border: 0px;
		}
		
		.device-table>tbody>tr>td {
			width: 25%;
			border: 0px
		}
		
		.queue-entry-table>tbody {
			height: 400px;
			overflow-x: hidden;
			overflow-y: auto;
		}
		
		.subscription-table>tbody {
			overflow-x: hidden;
			overflow-y: auto;
		}
		
		.dr-table {
			border-collapse: separate;
		}
		
		.toolbarIcon{
	        margin-bottom: -4px;
	        margin-right: 2px;
		}
	-->
	</style>
	
	<a4j:push interval="2000" eventProducer="#{devicesBean.addListener}" eventsQueue="requestQueue"
		reRender="deviceTable,requests,selectedDeviceDetail,subscriptions" ajaxSingle="true" />

	<rich:simpleTogglePanel switchType="client"
		label="#{app['devices.title']}" style="margin: 10px">
		
		<h:panelGrid columns="1" width="100%" style="padding: 0px;">
			<rich:dataGrid id="deviceTable" value="#{devicesBean.deviceList}" var="device"
				columns="4" elements="4" styleClass="device-table" width="100%"
				rowKey="#{device.id}">
				<rich:panel styleClass="#{device.id == devicesBean.selectedDeviceId ? 'selectedDevice' : '' }">
					<f:facet name="header">
						<h:outputText value="#{device.type}"></h:outputText>
					</f:facet>
		
					<a4j:support event="onclick" ajaxSingle="true" immediate="true"
						reRender="deviceDetail">
						<a4j:actionparam name="changeSelection" value="#{device.id}"
							assignTo="#{devicesBean.selectedDeviceId}" />
					</a4j:support>
		
		
					<!-- effect -->
					<rich:effect event="onmouseup" type="BlindDown" params="duration:0.8"
						reRenderAfterComplete="deviceTable" />
		
					<!-- device detail -->
					<cip4:deviceDetail device="#{device}" />
		
					<!-- job statistics -->
					<cip4:jobStatistics device="#{device}" />
				</rich:panel>
		
			</rich:dataGrid>
			<rich:datascroller for="deviceTable" immediate="true"></rich:datascroller>
		</h:panelGrid>

		<!-- Devices Count -->
		<h:panelGroup style="margin-left: 6px;">
			<h:outputText value="#{app['devices.count']}: " />
			<h:outputText value="#{devicesBean.devicesCount}" />
		</h:panelGroup>
		<h:panelGroup style="margin-left: 6px;">
			<h:outputText value="Requests: " />
			<h:outputText id="requests" value="#{devicesBean.numRequests}" />
		</h:panelGroup>

	</rich:simpleTogglePanel>
	
	<rich:simpleTogglePanel switchType="client"
		label="#{empty devicesBean.selectedDeviceId ? app['device.detail.noselection']: devicesBean.selectedDevice.type}" style="margin: 10px" id="deviceDetail">
		
		<h:panelGrid rendered="#{not empty devicesBean.selectedDeviceId}" columns="3" id="selectedDeviceDetail" style="margin-top: 10px; margin-bottom: 10px" >
			<cip4:deviceDetail device="#{devicesBean.selectedDevice}" />
			<rich:spacer width="10"/>
			<cip4:jobStatistics device="#{devicesBean.selectedDevice}" />
		</h:panelGrid>
		
		<!-- first panel: detail -->
		<rich:tabPanel switchType="ajax" height="500" rendered="#{not empty devicesBean.selectedDeviceId}">
			<rich:tab label="#{app['device.detail.details']}">
				<h:panelGrid columns="3">
					<h:outputText value="#{app['device.detail.id']}" />
					<h:outputText value="#{devicesBean.selectedDevice.id}" style="font-weight: bold;" />
					<h:outputText value="#{app['device.detail.desc.id']}" />
					
					<h:outputText value="#{app['device.detail.url']}" />
					<h:outputText value="#{devicesBean.selectedDevice.url}" style="font-weight: bold;" />
					<h:outputText value="#{app['device.detail.desc.url']}" />
					
					<h:outputText value="#{app['device.detail.type']}" />
					<h:outputText value="#{devicesBean.selectedDevice.type}" style="font-weight: bold;" />
					<h:outputText value="#{app['device.detail.desc.type']}" />
					
					<rich:spacer width="1" height="10" />
					<rich:spacer width="1" height="10" />
					<rich:spacer width="1" height="10" />
					
					<h:outputText value="#{app['device.detail.hotfolder']}" style="font-weight: bold;" />
					<rich:spacer width="1" height="1" />
					<rich:spacer width="1" height="1" />
					
					<h:outputText value="#{app['device.detail.hotfolder.input']}" />
					<h:outputText value="#{devicesBean.selectedDevice.hotfolder.inputFolder}" style="font-weight: bold;" />
					<h:outputText value="#{app['device.detail.desc.hotfolder.input']}" />
					
					<h:outputText value="#{app['device.detail.hotfolder.output']}" />
					<h:outputText value="#{devicesBean.selectedDevice.hotfolder.outputFolder}" style="font-weight: bold;" />
					<h:outputText value="#{app['device.detail.desc.hotfolder.output']}" />
					
					<h:outputText value="#{app['device.detail.hotfolder.error']}" />
					<h:outputText value="#{devicesBean.selectedDevice.hotfolder.errorFolder}" style="font-weight: bold;" />
					<h:outputText value="#{app['device.detail.desc.hotfolder.error']}" />
				</h:panelGrid>
			</rich:tab>
			
			<!-- second tab: queue -->
	        <rich:tab label="#{app['device.detail.queue']}">
	        	<!-- toolbar -->
	        	<rich:toolBar height="26" itemSeparator="grid">
					<rich:toolBarGroup>
						<a4j:commandButton image="/style/common/icons/fileopen.png" action="#{devicesBean.queueOpen}" ajaxSingle="true" immediate="true" title="#{app['queue.ctl.open']}" styleClass="toolbarIcon" />
					    <a4j:commandButton image="/style/common/icons/fileclose.png" action="#{devicesBean.queueClose}" ajaxSingle="true" immediate="true" title="#{app['queue.ctl.close']}" styleClass="toolbarIcon" />
					</rich:toolBarGroup>
					<rich:toolBarGroup>
						<a4j:commandButton image="/style/common/icons/player_pause.png" action="#{devicesBean.queueHold}" ajaxSingle="true" immediate="true" title="#{app['queue.ctl.hold']}" styleClass="toolbarIcon" />
					    <a4j:commandButton image="/style/common/icons/player_play.png" action="#{devicesBean.queueResume}" ajaxSingle="true" immediate="true" title="#{app['queue.ctl.resume']}" styleClass="toolbarIcon" />
			  		</rich:toolBarGroup>
			  		<rich:toolBarGroup>
					    <a4j:commandButton image="/style/common/icons/delete_table.png" action="#{devicesBean.queueFlush}" ajaxSingle="true" immediate="true" title="#{app['queue.ctl.flush']}" styleClass="toolbarIcon" />
			  		</rich:toolBarGroup>
	        	</rich:toolBar>
	        	
	        	<!-- diff update queue entries -->
	        	<a4j:poll action="#{devicesBean.updateQueue}" reRender="queueEntryStatus" ajaxSingle="true" immediate="true" />
	        	
	            <rich:dataTable value="#{devicesBean.selectedDeviceQueue}" var="entry" ajaxKeys="#{devicesBean.selectedDeviceQueueChanges}" styleClass="queue-entry-table" width="100%" style="margin-top: 5px" id="queueEntries" >
		         	<rich:column sortBy="#{entry.queueEntryId}">
		         		<f:facet name="header">
		                    <h:outputText value="#{app['queueEntry.id']}"/>
		                </f:facet>
						<h:outputText value="#{entry.queueEntryId}"/>
					</rich:column>
					<rich:column sortBy="#{entry.priority}" >
		         		<f:facet name="header">
		                    <h:outputText value="#{app['queueEntry.priority']}"/>
		                </f:facet>
						<h:outputText value="#{entry.priority}"/>
					</rich:column>
					<rich:column sortBy="#{entry.submissionTime}" >
		         		<f:facet name="header">
		                    <h:outputText value="#{app['queueEntry.submissionTime']}">
		                    	<f:convertDateTime dateStyle="short"/>
		                    </h:outputText>
		                </f:facet>
						<h:outputText value="#{entry.submissionTime}"/>
					</rich:column>
					<rich:column sortBy="#{entry.startTime}" >
		         		<f:facet name="header">
		                    <h:outputText value="#{app['queueEntry.startTime']}">
		                    	<f:convertDateTime dateStyle="short"/>
		                    </h:outputText>
		                </f:facet>
						<h:outputText value="#{entry.startTime}"/>
					</rich:column>
					<rich:column sortBy="#{entry.endTime}" >
		         		<f:facet name="header">
		                    <h:outputText value="#{app['queueEntry.endTime']}">
		                    	<f:convertDateTime dateStyle="short"/>
		                    </h:outputText>
		                </f:facet>
						<h:outputText value="#{entry.endTime}"/>
					</rich:column>
					<rich:column sortBy="#{entry.jobId}" >
		         		<f:facet name="header">
		                    <h:outputText value="#{app['queueEntry.jobId']}"/>
		                </f:facet>
						<h:outputText value="#{entry.jobId}"/>
					</rich:column>
					<rich:column sortBy="#{entry.jobPartId}" >
		         		<f:facet name="header">
		                    <h:outputText value="#{app['queueEntry.jobPartId']}"/>
		                </f:facet>
						<h:outputText value="#{entry.jobPartId}"/>
					</rich:column>
					<rich:column sortBy="#{entry.status}" >
		         		<f:facet name="header">
		                    <h:outputText value="#{app['queueEntry.status']}"/>
		                </f:facet>
						<h:outputText id="queueEntryStatus" value="#{entry.status}" />
					</rich:column>
		         </rich:dataTable>
	        </rich:tab>
	        
	        <!-- third tab: subscriptions -->
	        <rich:tab label="#{app['device.detail.subscriptions']}">
	            <rich:dataTable value="#{devicesBean.selectedDevice.msgSubscriptions}" var="subscription" styleClass="subscription-table" width="100%" style="margin-top: 5px" id="subscriptions" >
		         	<rich:column sortBy="#{subscription.channelId}" >
		         		<f:facet name="header">
		                    <h:outputText value="#{app['subscription.channelId']}"/>
		                </f:facet>
						<h:outputText value="#{subscription.channelId}"/>
					</rich:column>
					<rich:column sortBy="#{subscription.url}" >
		         		<f:facet name="header">
		                    <h:outputText value="#{app['subscription.url']}"/>
		                </f:facet>
						<h:outputText value="#{subscription.url}"/>
					</rich:column>
					<rich:column sortBy="#{subscription.type}" >
		         		<f:facet name="header">
		                    <h:outputText value="#{app['subscription.type']}">
		                    	<f:convertDateTime dateStyle="short"/>
		                    </h:outputText>
		                </f:facet>
						<h:outputText value="#{subscription.type}"/>
					</rich:column>
		         </rich:dataTable>
	        </rich:tab>
	    </rich:tabPanel>
		
		 

		 
		
	</rich:simpleTogglePanel>
</ui:composition>

</html>